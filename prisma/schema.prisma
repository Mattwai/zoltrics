generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                 String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId             String    @db.Uuid
  providerType       String
  providerId         String
  providerAccountId  String
  refreshToken       String?
  accessToken        String?
  accessTokenExpires DateTime?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  user               User      @relation(fields: [userId], references: [id])

  @@unique([providerId, providerAccountId])
}

model Session {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId       String   @db.Uuid
  expires      DateTime
  sessionToken String   @unique
  accessToken  String   @unique
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id])
}

model User {
  id                      String                   @id @default(uuid()) @db.Uuid
  email                   String                   @unique
  createdAt               DateTime                 @default(now())
  updatedAt               DateTime                 @updatedAt
  stripeId                String?
  emailVerified           DateTime?
  name                    String?
  businessName            String?
  bookingLink             String?                  @unique
  accounts                Account[]
  subscription            Billings?
  campaign                Campaign[]
  chatBot                 ChatBot?
  customTimeSlots         CustomTimeSlot[]
  domains                 Domain[]
  filterQuestions         FilterQuestions[]
  helpdesk                HelpDesk[]
  knowledgeBase           KnowledgeBase[]
  sessions                Session[]
  bookingCalendarSettings BookingCalendarSettings?
}

model VerificationRequest {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  identifier String
  token      String   @unique
  expires    DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([identifier, token])
}

model Domain {
  id       String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name     String
  userId   String?    @db.Uuid
  customer Customer[]
  User     User?      @relation(fields: [userId], references: [id], onDelete: Cascade)
  products Product[]
  Campaign Campaign[] @relation("CampaignToDomain")
}

model ChatBot {
  id             String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  welcomeMessage String?
  background     String?
  textColor      String?
  helpdesk       Boolean @default(false)
  userId         String? @unique @db.Uuid
  User           User?   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Billings {
  id      String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  plan    Plans   @default(STANDARD)
  credits Int     @default(10)
  userId  String? @unique @db.Uuid
  User    User?   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model HelpDesk {
  id       String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  question String
  answer   String
  userId   String? @db.Uuid
  User     User?   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model KnowledgeBase {
  id       String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title    String
  content  String
  category String?
  userId   String? @db.Uuid
  User     User?   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model FilterQuestions {
  id       String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  question String
  answered String?
  userId   String? @db.Uuid
  User     User?   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model CustomerResponses {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  question   String
  answered   String?
  customerId String   @db.Uuid
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
}

model Customer {
  id        String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email     String?             @unique
  domainId  String?             @db.Uuid
  createdAt DateTime            @default(now())
  updatedAt DateTime            @updatedAt
  booking   Bookings[]
  chatRoom  ChatRoom[]
  Domain    Domain?             @relation(fields: [domainId], references: [id], onDelete: Cascade)
  questions CustomerResponses[]
}

model ChatRoom {
  id         String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  live       Boolean       @default(false)
  mailed     Boolean       @default(false)
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  customerId String?       @db.Uuid
  message    ChatMessage[]
  Customer   Customer?     @relation(fields: [customerId], references: [id], onDelete: Cascade)
}

model ChatMessage {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  message    String
  role       Role?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  chatRoomId String?   @db.Uuid
  seen       Boolean   @default(false)
  ChatRoom   ChatRoom? @relation(fields: [chatRoomId], references: [id], onDelete: Cascade)
}

model Bookings {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  date            DateTime
  slot            String
  email           String
  customerId      String?   @db.Uuid
  domainId        String?   @db.Uuid
  productId       String?   @db.Uuid
  createdAt       DateTime  @default(now())
  source          String?   @default("direct_link")
  name            String
  depositRequired Boolean   @default(false)
  no_show         Boolean   @default(false)
  riskScore       Float?
  updatedAt       DateTime  @updatedAt
  depositPaid     Boolean   @default(false)
  googleUserId    String?   @db.Uuid
  isAuthenticated Boolean   @default(false)
  Customer        Customer? @relation(fields: [customerId], references: [id], onDelete: Cascade)
  Product         Product?  @relation(fields: [productId], references: [id])
}

model Campaign {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name      String
  customers String[]
  template  String?
  userId    String?  @db.Uuid
  createdAt DateTime @default(now())
  User      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  domain    Domain[] @relation("CampaignToDomain")
}

model Product {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name      String
  price     Int
  isLive    Boolean   @default(true)
  createdAt DateTime  @default(now())
  domainId  String?   @db.Uuid
  Domain    Domain?   @relation(fields: [domainId], references: [id], onDelete: Cascade)
  bookings  Bookings[]
}

model BookingCalendarSettings {
  id            String   @id @default(uuid()) @db.Uuid
  userId        String   @unique @db.Uuid
  availableDays String[]
  timeSlots     Json
  startDate     DateTime
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("booking_calendar_settings")
}

model CustomTimeSlot {
  id        String   @id @default(cuid())
  date      DateTime
  startTime String
  endTime   String
  duration  Int
  maxSlots  Int
  userId    String   @db.Uuid
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])

  @@index([userId, date])
}

enum Plans {
  STANDARD
  PROFESSIONAL
  BUSINESS
}

enum Role {
  user
  assistant
}
